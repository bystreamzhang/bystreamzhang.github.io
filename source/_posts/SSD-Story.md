---
title: SSD Story
date: 2025-08-13 11:13:32
hide: true
tags:
    - SSD
    - ZNS
categories: Study
---
# 说明

想以更生动形象的表述来串联一下SSD的世界。

参考《深入浅出SSD》

各个章节虽然彼此会联系，但希望尽量保持一定的阅读独立性。

## 内存

（待补充）

## 闪存

（待补充）


## NVMe

### NVMe 一 背景

NVMe是主机和SSD之间通信的协议。

主机和SSD都可以认为是国家，主机称为主机国，SSD是盟国，称SSD国。

主机国的核心军队是CPU，核心国土是内存。

这个世界的核心资源是电子。

电子本身是无穷无尽，无处不在的，关键是如何利用。就好像魔法世界里面的魔力一样。

电子在存储时根据数量被区分为0或1，而众多的0或1可以构成数据，众多的数据可以表达意义，就可以发挥神奇的力量。

主机国的国土内存提供一定的区域存储电子并加以利用，虽然方便但寸土寸金，所以需要与SSD国联系，不那么重要的数据就使用SSD国的空间。

NVMe就是两国之间的中介。可以认为是一个第三方神秘组织，简称NVMe工会。

### NVMe 二 NVMe工会

NVMe工会如何起到中介的作用？

工会中有“三宝”：

- SubmissionQueue（SQ，提交队列）
- CompletionQueue（CQ，完成队列）
- DoorBell register(DB，门铃队列)

可以认为是三件宝具，都需要开辟一定的国土来使用。

根据NVMe工会的规定，SQ和CQ需要由主机国开辟国土，而DB需要SSD国开辟国土。

当主机国需要向SSD国发出一个指令时，有以下八个步骤：

1. 主机国将指令内容写入SQ宝具所在国土
2. 主机国以某种方式写SQ对应的DQ，通知SSD国
3. SSD国以某种方式获取SQ中的数据
4. SSD国执行主机国的指令
5. 指令完成后，SSD国以某种方式往CQ中写指令执行结果
6. SSD发中断通知主机国指令完成
7. 收到中断，主机国处理CQ，查看指令完成状态
8. 主机国处理完CQ，以某种方式写DQ来回复SSD国

> 这里的“中断”暂时不在此NVMe章节解释

### NVMe 三 吉祥三宝

SQ宝具和CQ宝具是对应的，可以是一对一或者多对一。

效果上来看，可以理解为**记事本宝具**。

可以将某个区域的电子具象化为记事本，主机可以在其中记录信息，SSD可以获取。

SQ和CQ都是记事本宝具，为了保持数据的简洁有序，指令内容和指令的执行结果分别记录在SQ和CQ中。

类型

和CPU的关系

具体实现方法
